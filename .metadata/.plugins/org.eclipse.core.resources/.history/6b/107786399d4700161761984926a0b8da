package port;

import java.util.List;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.locks.Lock;

import org.apache.log4j.Logger;

import warehouse.Container;
import warehouse.Warehouse;

public class Berth {
	private final static Logger logger = Logger.getRootLogger();

	private int id;
	private Warehouse portWarehouse;

	public Berth(int id, Warehouse warehouse) {
		this.id = id;
		portWarehouse = warehouse;
	}

	public int getId() {
		return id;
	}

	public boolean add(Warehouse shipWarehouse, int numberOfConteiners) throws InterruptedException{
		boolean result = false;
		Lock portWarehouseLock = portWarehouse.getLock();
		Lock shipWarehouseLock = shipWarehouse.getLock();
		try{
			if (portWarehouseLock.tryLock(80, TimeUnit.SECONDS)){
				logger.debug("portWarehouseLock захвачен.");
				if (shipWarehouseLock.tryLock()){
					logger.debug("shipWarehouseLock захвачен.");
					List<Container> list = shipWarehouse.getContainer(numberOfConteiners);
					if(list!=null){
						result = portWarehouse.addContainer(list);
						logger.debug("код выполнен.");
					}
				}
			}
		}finally{
			shipWarehouseLock.unlock();		
			portWarehouseLock.unlock();
		}		
		return result;
		
	}

	public boolean get(Warehouse shipWarehouse, int numberOfConteiners) throws InterruptedException{
		boolean result = false;
		Lock portWarehouseLock = portWarehouse.getLock();
		Lock shipWarehouseLock = shipWarehouse.getLock();
		try{
			if (portWarehouseLock.tryLock(80, TimeUnit.SECONDS)){
				logger.debug("portWarehouseLock захвачен.");
				if (shipWarehouseLock.tryLock()){
					logger.debug("shipWarehouseLock захвачен.");
					List<Container> list = portWarehouse.getContainer(numberOfConteiners);
					if(list!=null){
						result = shipWarehouse.addContainer(list);
						logger.debug("код выполнен.");
					}
				}
			}
		}finally{
			shipWarehouseLock.unlock();		
			portWarehouseLock.unlock();
		}
		return result;
	}
	
	
}
